{
  "version": 6,
  "cmakeMinimumRequired": {
    "major": 3,
    "minor": 25,
    "patch": 0
  },
  "configurePresets": [
    {
      "name": "base",
      "hidden": true,
      "generator": "Ninja",
      "binaryDir": "${sourceDir}/build/${presetName}",
      "cacheVariables": {
        "CMAKE_EXPORT_COMPILE_COMMANDS": "ON",
        "ENABLE_TESTING": "ON"
      }
    },
    
    {
      "name": "mixin-san-address",
      "hidden": true,
      "cacheVariables": { "SANITIZER_MODE": "Address" }
    },
    {
      "name": "mixin-san-thread",
      "hidden": true,
      "cacheVariables": { "SANITIZER_MODE": "Thread" }
    },
    {
      "name": "mixin-san-memory",
      "hidden": true,
      "toolchainFile": "", 
      "description": "Requires libc++ build usually",
      "cacheVariables": { "SANITIZER_MODE": "Memory" }
    },
    {
      "name": "mixin-san-undefined",
      "hidden": true,
      "cacheVariables": { "SANITIZER_MODE": "Undefined" }
    },
    {
      "name": "mixin-san-none",
      "hidden": true,
      "cacheVariables": { "SANITIZER_MODE": "None" }
    },

    {
      "name": "dev-debug-asan",
      "displayName": "Debug + Address Sanitizer",
      "description": "Standard development build: Debug symbols + ASan + UBSan",
      "inherits": ["base", "mixin-san-address"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "Debug" }
    },
    {
      "name": "dev-debug-tsan",
      "displayName": "Debug + Thread Sanitizer",
      "inherits": ["base", "mixin-san-thread"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "Debug" }
    },
    {
      "name": "dev-debug-msan",
      "displayName": "Debug + Memory Sanitizer",
      "inherits": ["base", "mixin-san-memory"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "Debug" }
    },
    {
      "name": "dev-debug-ubsan",
      "displayName": "Debug + Only UBSan",
      "inherits": ["base", "mixin-san-undefined"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "Debug" }
    },

    {
      "name": "ci-release",
      "displayName": "Release (No Sanitizers)",
      "description": "Maximum optimization, no sanitizers",
      "inherits": ["base", "mixin-san-none"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "Release" }
    },
    {
      "name": "ci-relwithdebinfo",
      "displayName": "RelWithDebInfo",
      "inherits": ["base", "mixin-san-none"],
      "cacheVariables": { "CMAKE_BUILD_TYPE": "RelWithDebInfo" }
    }
  ],

  "buildPresets": [
    { "name": "dev-debug-asan", "configurePreset": "dev-debug-asan" },
    { "name": "dev-debug-tsan", "configurePreset": "dev-debug-tsan" },
    { "name": "dev-debug-msan", "configurePreset": "dev-debug-msan" },
    { "name": "dev-debug-ubsan", "configurePreset": "dev-debug-ubsan" },
    { "name": "ci-release",     "configurePreset": "ci-release" },
    { "name": "ci-relwithdebinfo", "configurePreset": "ci-relwithdebinfo" }
  ],

  "testPresets": [
    {
      "name": "dev-debug-asan",
      "configurePreset": "dev-debug-asan",
      "output": { "outputOnFailure": true },
      "execution": { "noTestsAction": "error", "stopOnFailure": true }
    },
    {
      "name": "dev-debug-tsan",
      "configurePreset": "dev-debug-tsan",
      "output": { "outputOnFailure": true }
    },
    {
      "name": "ci-release",
      "configurePreset": "ci-release",
      "output": { "outputOnFailure": true }
    }
  ]
}